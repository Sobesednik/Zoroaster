{"version":3,"sources":["../../src/lib/index.js"],"names":[],"mappings":"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","file":"lib/index.js","sourcesContent":["import cleanStack from 'clean-stack'\nimport { EOL } from 'os'\n\n/**\n * Run all tests in sequence, one by one.\n * @param {Test[]} tests An array with tests\n * @param {function} [notify] A notify function to be passed to run method\n */\nexport async function runInSequence(tests, notify) {\n  await tests.reduce(async (acc, t) => {\n    await acc\n    await t.run(notify)\n  }, Promise.resolve())\n  return tests\n}\n\nexport function indent(str, padding) {\n  return str.replace(/^(?!\\s*$)/mg, padding)\n}\n\nexport function getPadding(level) {\n  return Array\n    .from({ length: level * 2 })\n    .join(' ')\n}\n\nexport function checkTestSuiteName(name) {\n  if (typeof name != 'string') {\n    throw new Error('Test suite name must be given.')\n  }\n}\n\n/**\n * Get clean stack for a test, without Node internals\n * @param {Test} test - test\n */\nexport function filterStack({ error, name }) {\n  if (!error) {\n    throw new Error('cannot filter stack when a test does not have an error')\n  }\n  const splitStack = error.stack.split('\\n') // break stack by \\n and not EOL intentionally because Node uses \\n\n  // node 4 will print: at test_suite.test2\n  // node 6 will print: at test2\n  const regex = new RegExp(`at (.+\\.)?${name}`)\n  const resIndex = splitStack.findIndex(element => regex.test(element)) + 1\n  const joinedStack = splitStack.slice(0, resIndex).join('\\n')\n  const stack = joinedStack ? joinedStack : cleanStack(error.stack) // use clean stack for async errors\n  return stack.replace(/\\n/g, EOL)\n}\n\nexport function isFunction(fn) {\n  return (typeof fn).toLowerCase() == 'function'\n}\n\nexport const bindMethods = (instance, ignore = []) => {\n  const methods = Object.getOwnPropertyDescriptors(Object.getPrototypeOf(instance))\n  const boundMethods = Object.keys(methods)\n    .filter((k) => {\n      return ignore.indexOf(k) < 0\n    })\n    .reduce((acc, k) => {\n      const method = methods[k]\n      const isFn = isFunction(method.value)\n      if (!isFn) return acc\n      method.value = method.value.bind(instance)\n      return {\n        ...acc,\n        [k]: method,\n      }\n    }, {})\n  Object.defineProperties(instance, boundMethods)\n}\n\nexport const evaluateContext = async (context) => {\n  const fn = isFunction(context)\n  if (!fn) return context\n\n  try {\n    const c = {}\n    await context.call(c)\n    return c\n  } catch (err) {\n    if (!/^Class constructor/.test(err.message)) {\n      throw err\n    }\n    // constructor context\n    const c = new context()\n    if (c._init) {\n      await c._init()\n    }\n\n    bindMethods(c, ['constructor', '_init', '_destroy'])\n\n    return c\n  }\n}\n\nexport const destroyContexts = async (contexts) => {\n  const dc = contexts.map(async (c) => {\n    if (isFunction(c._destroy)) {\n      const res = await c._destroy()\n      return res\n    }\n  })\n  const res = await Promise.all(dc)\n  return res\n}\n"]}